"outline.json":
  cmd: cp basic.json outline.json
  dependencies:
    - basic.json
    - deps/a
    - deps/b

"resources/$RESOURCE/about.json":
  cmd: cp basic.json resources/$RESOURCE/about.json
  dependencies:
    - basic.json
    - outline.json
    - resources/$RESOURCE/description.md
  variables:
    RESOURCE:
      ls resources

"sub$LEVEL1/outline.json":
  cmd: |
    cp basic.json sub$LEVEL1/outline.json
  dependencies:
    - outline.json
    - resources/$RESOURCE/about.json
  variables:
    LEVEL1:
      jq -r 'range(0; .sections | length)' outline.json

# this target requires $LEVEL1, but does not directly define it
# it should "inherit" the definition from the outline.json target above
"sub$LEVEL1/wc":
  cmd: |
    cd sub$LEVEL1
    wc -l outline.json > wc
  dependencies:
    - sub$LEVEL1/outline.json

# this target will recursively inherrit the $LEVEL1 definition
# from sub$LEVEL1/outline.json via sub$LEVEL1/wc
"sub$LEVEL1/wc2":
  cmd: |
    cd sub$LEVEL1
    wc -l wc > wc2
  dependencies:
    - sub$LEVEL1/wc

"sub$LEVEL1/sub$LEVEL2/outline.json":
  cmd: |
    cp basic.json sub$LEVEL1/sub$LEVEL2/outline.json
  dependencies:
    - outline.json
    - sub$LEVEL1/outline.json
  variables:
    LEVEL2: |
      jq -r "range(0; [.sections | length, $(($LEVEL1 + 1))] | min )" sub$LEVEL1/outline.json
    # notice that LEVEL1 is not defined here and will be inherrited

# this target inherits $LEVEL1 and $LEVEL2
"sub$LEVEL1/sub$LEVEL2/wc":
  cmd: |
    cd sub$LEVEL1/sub$LEVEL2
    wc -l outline.json > wc
  dependencies:
    - sub$LEVEL1/sub$LEVEL2/outline.json

# this target inherits $LEVEL1 and $LEVEL2 recursively
"sub$LEVEL1/sub$LEVEL2/wc2":
  cmd: |
    cd sub$LEVEL1/sub$LEVEL2
    wc -l wc > wc2
  dependencies:
    - sub$LEVEL1/sub$LEVEL2/wc

"final.txt":
  cmd: |
    echo hello > "final.txt"
  dependencies:
    - sub$LEVEL1/sub$LEVEL2/outline.json
